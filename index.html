<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<title>Kids O'Day Enroll</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
:root{--accent:#1a73e8;--bg:#f7f9fc;--card:#ffffff;--border:#e6e9ef;--muted:#666;}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#222;}
.wrap{max-width:960px;margin:24px auto;padding:16px;}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;box-shadow:0 6px 20px rgba(0,0,0,.04);}
h1{margin:0;font-size:22px;color:var(--accent);}
#status{color:var(--muted);font-size:13px;margin:12px 0 20px;}
#courses{display:none;margin-top:16px;}
.course-btn{display:block;margin-bottom:12px;background:var(--accent);color:#fff;padding:10px 16px;border-radius:8px;font-weight:700;text-decoration:none;text-align:center;}
#login{margin-top:16px;}
#logout{margin-top:20px;font-size:13px;}
#logout a{color:#555;text-decoration:none;}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Enroll in a Course</h1>
    <div id="status">Checking sessionâ€¦</div>
    <div id="login"></div>
    <div id="courses"></div>
    <div id="logout" style="display:none;"><a href="#" onclick="signOut();return false;">Sign out</a></div>
  </div>
</div>

<script>
const CLIENT_ID="656751987892-s5h4b3h7aq6rl63ut7pl6hgm3d2vr46p.apps.googleusercontent.com";
const API_URL="https://script.google.com/macros/s/AKfycbyeKrGPdEFxzq312Z4lnjYKjvhupSL2SkGos1LtzbSmO1YVWWFNpEHY29248uYN_-xHgA/exec";
const COURSES=["LEVEL-01","LEVEL-02","LEVEL-03","LEVEL-04","LEVEL-05","LEVEL-06","LEVEL-07","LEVEL-08","LEVEL-09","LEVEL-10","LEVEL-11","LEVEL-12"];

const el=id=>document.getElementById(id);
const esc=s=>(s||"").toString().replace(/[&<>]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]));

function saveSession(email){localStorage.setItem("kidsoday_email",email);localStorage.setItem("kidsoday_until",Date.now()+30*86400000);}
function getSession(){const e=localStorage.getItem("kidsoday_email");const u=localStorage.getItem("kidsoday_until");if(e&&u&&Date.now()<+u)return e;return null;}
function signOut(){localStorage.clear();location.reload();}

function renderCourses(data){
  const coursesDiv=el("courses");coursesDiv.innerHTML="";coursesDiv.style.display="block";
  const enrolled=data.records.map(r=>r["Course Code"]);
  COURSES.forEach(code=>{
    const btn=document.createElement("a");
    btn.className="course-btn";
    btn.href=enrolled.includes(code)?"#":"https://www.kidsoday.com/payment-page?course="+encodeURIComponent(code);
    btn.textContent=code+(enrolled.includes(code)?" (Already Enrolled)":"");
    coursesDiv.appendChild(btn);
  });
  el("logout").style.display="block";el("status").textContent="Select a course to enroll";
}

function load(email){
  fetch(API_URL+"?credential="+encodeURIComponent(localStorage.getItem("kidsoday_credential")))
    .then(r=>r.json())
    .then(data=>{renderCourses(data);})
    .catch(err=>{console.error(err);el("status").textContent="Failed to load enrollment info";});
}

function onGoogle(res){
  localStorage.setItem("kidsoday_credential",res.credential);
  const payload=JSON.parse(atob(res.credential.split(".")[1]));
  saveSession(payload.email);
  el("login").style.display="none";
  load(payload.email);
}

window.onload=()=>{
  const s=getSession();
  google.accounts.id.initialize({client_id:CLIENT_ID,callback:onGoogle});
  if(s){el("login").style.display="none";load(s);}
  else{el("status").textContent="Please sign in to continue";google.accounts.id.renderButton(el("login"),{theme:"outline",size:"large"});}
};
</script>
</body>
</html>
