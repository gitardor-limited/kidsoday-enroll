<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Kids O'Day Enroll</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
:root{--accent:#1a73e8;--bg:#f7f9fc;--card:#fff;--border:#e6e9ef;--muted:#666;}
body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#222;}
.wrap{max-width:960px;margin:24px auto;padding:16px;}
.card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:20px;box-shadow:0 6px 20px rgba(0,0,0,.04);}
h1{margin:0;font-size:22px;color:var(--accent);}
#status{color:var(--muted);font-size:13px;margin:12px 0 20px;}
.course-btn{display:inline-block;margin:6px; padding:10px 16px;border-radius:8px;background:var(--accent);color:#fff;font-weight:700;text-decoration:none;}
.course-btn.disabled{background:#aaa; cursor:not-allowed;}
#login{margin-top:16px;}
</style>
</head>
<body>
<div class="wrap">
<div class="card">
<h1>Select a Course</h1>
<div id="status">Checking sessionâ€¦</div>
<div id="login"></div>
<div id="content" style="display:none;"></div>
</div>
</div>

<script>
const CLIENT_ID="656751987892-s5h4b3h7aq6rl63ut7pl6hgm3d2vr46p.apps.googleusercontent.com";
const API_URL="https://script.google.com/macros/s/AKfycbyeKrGPdEFxzq312Z4lnjYKjvhupSL2SkGos1LtzbSmO1YVWWFNpEHY29248uYN_-xHgA/exec";
const COURSES=["LEVEL-01","LEVEL-02","LEVEL-03","LEVEL-04","LEVEL-05","LEVEL-06","LEVEL-07","LEVEL-08","LEVEL-09","LEVEL-10","LEVEL-11","LEVEL-12"];
const PAYMENT_BASE="https://www.kidsoday.com/payment?course=";

const el=id=>document.getElementById(id);
const esc=s=>(s||"").toString().replace(/[&<>]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]));

function saveSession(cred){ localStorage.setItem("kidsoday_cred",cred); localStorage.setItem("kidsoday_until",Date.now()+30*86400000);}
function getSession(){ const c=localStorage.getItem("kidsoday_cred"); const u=localStorage.getItem("kidsoday_until"); if(c && u && Date.now()<+u) return c; return null;}
function signOut(){ localStorage.clear(); location.reload();}

function renderCourses(data){
  el("status").textContent="Select a course to enroll";
  let html="";
  COURSES.forEach(code=>{
    let enrolled=false;
    if(data.records && data.records.length>0){
      enrolled=data.records.some(r=>r["Course Code"]===code);
    }
    html+=`<a class="course-btn ${enrolled?"disabled":""}" href="${enrolled?"#":PAYMENT_BASE+encodeURIComponent(code)}">${code} ${enrolled?"(Already Enrolled)":""}</a>`;
  });
  el("content").innerHTML=html;
  el("content").style.display="block";
}

function load(cred){
  fetch(API_URL+"?credential="+encodeURIComponent(cred))
  .then(r=>r.json())
  .then(data=>renderCourses(data))
  .catch(err=>{ console.error(err); el("status").textContent="Failed to load enrollment info"; });
}

function onGoogle(res){
  saveSession(res.credential);
  el("login").style.display="none";
  load(res.credential);
}

window.onload=()=>{
  const s=getSession();
  google.accounts.id.initialize({ client_id: CLIENT_ID, callback: onGoogle });
  if(s){ el("login").style.display="none"; load(s); } 
  else{ el("status").textContent="Please sign in to continue"; google.accounts.id.renderButton(el("login"), {theme:"outline",size:"large"});}
};
</script>
</body>
</html>
