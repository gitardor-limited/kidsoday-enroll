<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kids O'Day Enroll</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <style>
    :root {
      --accent:#1a73e8;
      --bg:#f7f9fc;
      --card:#ffffff;
      --border:#e6e9ef;
      --muted:#666;
    }
    body {
      margin:0;
      font-family: Inter, Arial, sans-serif;
      background:var(--bg);
    }
    .wrap {
      max-width:960px;
      margin:24px auto;
      padding:16px;
    }
    .card {
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:20px;
      box-shadow:0 6px 20px rgba(0,0,0,.04);
    }
    h1 { color:var(--accent); }
    #status { font-size:13px; color:#666; margin:12px 0; }
    .course-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
      gap:12px;
    }
    .course-btn {
      padding:10px;
      border-radius:8px;
      border:none;
      font-weight:700;
      cursor:pointer;
      background:var(--accent);
      color:#fff;
    }
    .course-btn.disabled {
      background:#aaa;
      cursor:default;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>Enroll in a Course</h1>
    <div id="status">Please sign in</div>
    <div id="login"></div>
    <div id="content" style="display:none;"></div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const CLIENT_ID = "656751987892-s5h4b3h7aq6rl63ut7pl6hgm3d2vr46p.apps.googleusercontent.com";
const API_URL = "https://script.google.com/macros/s/AKfycbyeKrGPdEFxzq312Z4lnjYKjvhupSL2SkGos1LtzbSmO1YVWWFNpEHY29248uYN_-xHgA/exec";
const PAYMENT_URL = "https://www.kidsoday.com/payment-page";

const COURSES = [
  "LEVEL-01","LEVEL-02","LEVEL-03","LEVEL-04","LEVEL-05","LEVEL-06",
  "LEVEL-07","LEVEL-08","LEVEL-09","LEVEL-10","LEVEL-11","LEVEL-12"
];

/* ================= HELPERS ================= */
const el = id => document.getElementById(id);

/* ================= RENDER ================= */
function render(enrolled){
  let html = `<div class="course-grid">`;
  COURSES.forEach(c=>{
    const dis = enrolled.includes(c);
    html += `
      <button class="course-btn ${dis?"disabled":""}"
        ${dis?"disabled":""}
        onclick="window.open('${PAYMENT_URL}?course=${c}','_blank')">
        ${c}<br>${dis?"Enrolled":"Enroll"}
      </button>`;
  });
  html += `</div>`;
  el("content").innerHTML = html;
  el("content").style.display = "block";
}

/* ================= LOAD ================= */
function loadWithFreshToken(){
  google.accounts.id.prompt(notification=>{
    if(notification.isNotDisplayed()) return;
  });
}

/* ================= GOOGLE CALLBACK ================= */
function onGoogle(res){
  el("status").textContent = "Checking enrollmentâ€¦";
  fetch(API_URL + "?credential=" + encodeURIComponent(res.credential))
    .then(r=>r.json())
    .then(data=>{
      if(data.error){
        el("status").textContent = data.error;
        return;
      }
      const enrolled = (data.records||[]).map(r=>r["Course Code"]);
      render(enrolled);
      el("status").textContent = "Select a course";
    });
}

window.onload = ()=>{
  google.accounts.id.initialize({
    client_id: CLIENT_ID,
    callback: onGoogle,
    auto_select: true
  });
  google.accounts.id.renderButton(el("login"), { theme:"outline", size:"large" });
};
</script>
</body>
</html>
